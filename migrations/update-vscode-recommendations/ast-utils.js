"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function readJsonInTree(host, path) {
    if (!host.exists(path)) {
        throw new Error(`Cannot find ${path}`);
    }
    const json = host.read(path);
    if (!json) {
        throw new Error(`Cannot read ${path}`);
    }
    return JSON.parse(json.toString('utf-8'));
}
exports.readJsonInTree = readJsonInTree;
function serializeJson(json) {
    return `${JSON.stringify(json, null, 2)}\n`;
}
exports.serializeJson = serializeJson;
function updateJsonInTree(path, callback) {
    return (host) => {
        if (!host.exists(path)) {
            host.create(path, serializeJson(callback({})));
            return host;
        }
        host.overwrite(path, serializeJson(callback(readJsonInTree(host, path))));
        return host;
    };
}
exports.updateJsonInTree = updateJsonInTree;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXN0LXV0aWxzLmpzIiwic291cmNlUm9vdCI6Ii4vIiwic291cmNlcyI6WyJwYWNrYWdlcy9zY2hlbWF0aWNzL2FuZ3VsYXIvbWlncmF0aW9ucy91cGRhdGUtdnNjb2RlLXJlY29tbWVuZGF0aW9ucy9hc3QtdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFTQSxTQUFnQixjQUFjLENBQUksSUFBVSxFQUFFLElBQVk7SUFDeEQsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDdEIsTUFBTSxJQUFJLEtBQUssQ0FBQyxlQUFlLElBQUksRUFBRSxDQUFDLENBQUM7S0FDeEM7SUFFRCxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzdCLElBQUksQ0FBQyxJQUFJLEVBQUU7UUFDVCxNQUFNLElBQUksS0FBSyxDQUFDLGVBQWUsSUFBSSxFQUFFLENBQUMsQ0FBQztLQUN4QztJQUVELE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7QUFDNUMsQ0FBQztBQVhELHdDQVdDO0FBRUQsU0FBZ0IsYUFBYSxDQUFJLElBQU87SUFDdEMsT0FBTyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDO0FBQzlDLENBQUM7QUFGRCxzQ0FFQztBQUVELFNBQWdCLGdCQUFnQixDQUM5QixJQUFZLEVBQ1osUUFBd0I7SUFFeEIsT0FBTyxDQUFDLElBQVUsRUFBUSxFQUFFO1FBQzFCLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxRQUFRLENBQUMsRUFBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXBELE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFDRCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxhQUFhLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFMUUsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDLENBQUM7QUFDSixDQUFDO0FBZEQsNENBY0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZVxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL2FuZ3VsYXIuaW8vbGljZW5zZVxuICovXG5pbXBvcnQgeyBSdWxlLCBUcmVlIH0gZnJvbSAnQGFuZ3VsYXItZGV2a2l0L3NjaGVtYXRpY3MnO1xuXG5leHBvcnQgZnVuY3Rpb24gcmVhZEpzb25JblRyZWU8VD4oaG9zdDogVHJlZSwgcGF0aDogc3RyaW5nKTogVCB7XG4gIGlmICghaG9zdC5leGlzdHMocGF0aCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBmaW5kICR7cGF0aH1gKTtcbiAgfVxuXG4gIGNvbnN0IGpzb24gPSBob3N0LnJlYWQocGF0aCk7XG4gIGlmICghanNvbikge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHJlYWQgJHtwYXRofWApO1xuICB9XG5cbiAgcmV0dXJuIEpTT04ucGFyc2UoanNvbi50b1N0cmluZygndXRmLTgnKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXJpYWxpemVKc29uPFQ+KGpzb246IFQpOiBzdHJpbmcge1xuICByZXR1cm4gYCR7SlNPTi5zdHJpbmdpZnkoanNvbiwgbnVsbCwgMil9XFxuYDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUpzb25JblRyZWU8VCwgTyA9IFQ+KFxuICBwYXRoOiBzdHJpbmcsXG4gIGNhbGxiYWNrOiAoanNvbjogVCkgPT4gTyxcbik6IFJ1bGUge1xuICByZXR1cm4gKGhvc3Q6IFRyZWUpOiBUcmVlID0+IHtcbiAgICBpZiAoIWhvc3QuZXhpc3RzKHBhdGgpKSB7XG4gICAgICBob3N0LmNyZWF0ZShwYXRoLCBzZXJpYWxpemVKc29uKGNhbGxiYWNrKHt9IGFzIFQpKSk7XG5cbiAgICAgIHJldHVybiBob3N0O1xuICAgIH1cbiAgICBob3N0Lm92ZXJ3cml0ZShwYXRoLCBzZXJpYWxpemVKc29uKGNhbGxiYWNrKHJlYWRKc29uSW5UcmVlKGhvc3QsIHBhdGgpKSkpO1xuXG4gICAgcmV0dXJuIGhvc3Q7XG4gIH07XG59XG4iXX0=